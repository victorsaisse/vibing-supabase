# 🏠 Vibing with Supabase - Apartment Ranking Demo

A modern apartment customization and ranking application built with **Next.js 15**, **Supabase**, and **shadcn/ui**. Users can design their dream apartment and vote on others' creations in real-time.

## ✨ Features

- 🎨 **Apartment Customization** - Choose wall colors, sofas, and mirrors
- 🔄 **Real-time Updates** - See votes update instantly across all users
- 📱 **Mobile-Friendly** - Responsive design that works on all devices
- 🔐 **Email Authentication** - Simple email-based user identification
- 🗳️ **Voting System** - Upvote apartments with duplicate prevention
- 📊 **Live Ranking** - Dynamic leaderboard sorted by votes
- 🖼️ **Preview Modal** - Click thumbnails to see full apartment designs

## 🛠️ Tech Stack

- **Frontend**: Next.js 15, TypeScript, Tailwind CSS
- **UI Components**: shadcn/ui
- **Backend**: Supabase (PostgreSQL, Real-time subscriptions)
- **Authentication**: Email-based (no passwords required)

## 🚀 Quick Start

### 1. Clone the Repository

```bash
git clone <your-repo-url>
cd vibing-supabase
npm install
```

### 2. Set Up Supabase

#### Create a New Supabase Project

1. Go to [supabase.com](https://supabase.com)
2. Create a new project
3. Wait for the database to set up

#### Run the SQL Setup

In your Supabase project dashboard, go to **SQL Editor** and run this script:

```sql
-- Create the apartments table
create table apartments (
  id bigint generated by default as identity primary key,
  email text unique not null,
  left_wall_color text not null,
  right_wall_color text not null,
  selected_sofa text not null,
  selected_mirror text not null,
  votes integer default 1,
  created_at timestamp default now(),
  updated_at timestamp default now()
);

-- Create the votes table to track who voted for what
create table apartment_votes (
  id bigint generated by default as identity primary key,
  voter_email text not null,
  apartment_email text not null references apartments(email) on delete cascade,
  created_at timestamp default now(),
  unique(voter_email, apartment_email)
);

-- Enable Row Level Security
alter table apartments enable row level security;
alter table apartment_votes enable row level security;

-- Create policies for apartments table
create policy "Anyone can read apartments" on apartments
  for select using (true);

create policy "Users can insert their own apartment" on apartments
  for insert with check (true);

create policy "Users can update their own apartment" on apartments
  for update using (true);

-- Create policies for votes table
create policy "Anyone can read votes" on apartment_votes
  for select using (true);

create policy "Users can insert votes" on apartment_votes
  for insert with check (true);

create policy "Users can delete their own votes" on apartment_votes
  for delete using (true);

-- Create function to update apartment votes count
create or replace function update_apartment_votes()
returns trigger as $$
begin
  if TG_OP = 'INSERT' then
    update apartments
    set votes = votes + 1
    where email = NEW.apartment_email;
    return NEW;
  elsif TG_OP = 'DELETE' then
    update apartments
    set votes = votes - 1
    where email = OLD.apartment_email;
    return OLD;
  end if;
  return null;
end;
$$ language plpgsql;

-- Create trigger to automatically update vote counts
create trigger apartment_votes_trigger
  after insert or delete on apartment_votes
  for each row execute function update_apartment_votes();

-- Create function to update updated_at timestamp
create or replace function update_updated_at_column()
returns trigger as $$
begin
  NEW.updated_at = now();
  return NEW;
end;
$$ language plpgsql;

-- Create trigger for updated_at
create trigger update_apartments_updated_at
  before update on apartments
  for each row execute function update_updated_at_column();
```

### 3. Configure Environment Variables

Create a `.env.local` file in your project root:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

**To find these values:**

1. Go to your Supabase project dashboard
2. Navigate to **Settings** → **API**
3. Copy the **Project URL** and **anon public** key

### 4. Run the Application

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

## 🎮 How to Use

1. **Enter Email** - Start by entering your email on the home page
2. **Design Apartment** - Choose wall colors, sofa, and mirror
3. **Save & View Ranking** - Your apartment appears in the ranking
4. **Vote on Others** - Click ▲ to upvote other apartments
5. **View Details** - Click apartment thumbnails to see full designs

## 📁 Project Structure

```
src/
├── app/                    # Next.js 15 app router
│   ├── page.tsx           # Home page (email entry)
│   ├── create/            # Apartment customization
│   └── ranking/           # Voting and leaderboard
├── components/
│   ├── ui/                # shadcn/ui components
│   ├── ApartmentPreview.tsx
│   └── ApartmentModal.tsx
├── context/
│   └── AuthContext.tsx    # User state management
└── lib/
    ├── supabase.ts        # Database operations
    └── utils.ts           # Utilities
```

## 🗄️ Database Schema

### `apartments` Table

- **email** (text, unique) - User identifier
- **left_wall_color** (text) - Left wall hex color
- **right_wall_color** (text) - Right wall hex color
- **selected_sofa** (text) - Sofa image URL
- **selected_mirror** (text) - Mirror image URL
- **votes** (integer) - Vote count
- **created_at/updated_at** (timestamp) - Tracking

### `apartment_votes` Table

- **voter_email** (text) - Who voted
- **apartment_email** (text) - Which apartment
- **created_at** (timestamp) - When voted
- **Unique constraint** - Prevents duplicate votes

## 🔄 Real-time Features

The app uses Supabase's real-time capabilities:

- **Live Vote Updates** - See vote counts change instantly
- **Cross-tab Sync** - Changes appear across browser tabs
- **Multi-user Experience** - All users see updates simultaneously

## 🎨 Customization Options

- **Wall Colors**: 8 predefined colors (red, yellow, green, blue, purple, pink, gold, sky)
- **Sofas**: 4 different sofa designs from Supabase storage
- **Mirrors**: 3 different mirror styles from Supabase storage

## 🔧 Key Features Implementation

- **Upsert Logic** - Users can update their existing apartment design
- **Vote Prevention** - Database constraints prevent duplicate voting
- **Responsive Design** - Mobile-first approach with Tailwind CSS
- **Error Handling** - Graceful fallbacks for network issues
- **Loading States** - Smooth UX during data fetching

## 📱 Mobile Experience

- Full-width apartment preview on mobile
- Touch-friendly voting buttons
- Responsive modal dialogs
- Optimized image loading

## 🚦 Development

```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Build for production
npm run build

# Start production server
npm start
```

## 🤝 Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 📄 License

This project is open source and available under the [MIT License](LICENSE).

---

**Built with ❤️ using Supabase + Next.js**
